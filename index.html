    .note{ text-align:center;color:#bbb;font-size:11px;opacity:.7;margin-top:8px; }

    /* ===== Welcome overlay (tap to enable sound) ===== */
    .overlay{ position:fixed; inset:0; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px; z-index:100; transition:opacity .25s ease; }
    .overlay h2{ margin:0; font-size:20px; font-weight:700; letter-spacing:.02em }
    .overlay .by{ font-size:14px; opacity:.8; margin-top:-6px }
    .overlay .start{ margin-top:10px; height:52px; padding:0 26px; border-radius:16px; border:2px solid #333; background:#111; color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; letter-spacing:.12em }
    .overlay .start:hover{ border-color:#fff; background:#141414 }
    .overlay.hidden{ opacity:0; pointer-events:none }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>Counter</h1>
      <div class="toolbar">
        <button id="muteBtn" class="mute-btn" aria-pressed="false" aria-label="Toggle sound">
          <!-- default: sound on (bell) -->
          <svg class="icon" id="iconBell" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 3a5 5 0 0 1 5 5v2.3c0 .8.3 1.6.8 2.2l1 1.2c.7.8.1 2-1 2H6.2c-1.1 0-1.7-1.2-1-2l1-1.2c.5-.6.8-1.4.8-2.2V8a5 5 0 0 1 5-5Z" fill="currentColor"/>
            <path d="M9.5 18a2.5 2.5 0 0 0 5 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" fill="none"/>
          </svg>
          <svg class="icon" id="iconBellOff" viewBox="0 0 24 24" aria-hidden="true" style="display:none">
            <path d="M4 4l16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M12 3a5 5 0 0 1 5 5v2.3c0 .8.3 1.6.8 2.2l1 1.2c.7.8.1 2-1 2H8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M6.2 15c-1.1 0-1.7-1.2-1-2l1-1.2c.5-.6.8-1.4.8-2.2V8c0-1.6.8-3 2-3.9" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M9.5 18a2.5 2.5 0 0 0 5 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" fill="none"/>
          </svg>
        </button>
      </div>
    </header>

    <main class="count">
      <div class="value" id="value">0</div>
    </main>

    <!-- Welcome / Tap to start overlay -->
    <div id="overlay" class="overlay">
      <h2>Counter</h2>
      <div class="by">by <strong>StarShots ID</strong></div>
      <button id="startBtn" class="start" aria-label="Start">TAP TO START</button>
    </div>

    <section>
      <button id="reset" aria-label="Reset">RESET</button>
      <div class="controls">
        <button class="btn btn-minus" id="dec" aria-label="Decrease">
          <svg class="glyph" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 12h14" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
          </svg>
        </button>
        <button class="btn btn-plus"  id="inc" aria-label="Increase">
          <svg class="glyph" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
          </svg>
        </button>
      </div>
      <div class="note">hold for faster value</div>
    </section>
  </div>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }

  (function(){
    const valueEl = document.getElementById('value');
    const incBtn  = document.getElementById('inc');
    const decBtn  = document.getElementById('dec');
    const resetBtn= document.getElementById('reset');

    // Welcome overlay
    const overlayEl = document.getElementById('overlay');
    const startBtn = document.getElementById('startBtn');

    // Mute toggle elements
    const muteBtn = document.getElementById('muteBtn');
    const iconBell = document.getElementById('iconBell');
    const iconBellOff = document.getElementById('iconBellOff');

    let total = Number(localStorage.getItem('counter:total') || 0);
    let muted = localStorage.getItem('counter:muted') === '1';

    const save = ()=>localStorage.setItem('counter:total', total);
    const saveMuted = ()=>localStorage.setItem('counter:muted', muted ? '1' : '0');
    const render=()=>{ valueEl.textContent = total; };

    // WebAudio click
    let audioCtx=null, master=null, comp=null, lastSoundTime=0;
    function ensureAudio(){
      if (!audioCtx) {
        audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        comp = audioCtx.createDynamicsCompressor();
        comp.threshold.setValueAtTime(-24, audioCtx.currentTime);
        comp.knee.setValueAtTime(30, audioCtx.currentTime);
        comp.ratio.setValueAtTime(12, audioCtx.currentTime);
        master = audioCtx.createGain(); master.gain.value = 0.6;
        comp.connect(master).connect(audioCtx.destination);
      }
      if (audioCtx.state === 'suspended') audioCtx.resume();
      // warm up the audio pipeline with an inaudible blip so first real click is heard
      try { warmupAudio(); } catch {}
    }
      if (audioCtx.state === 'suspended') audioCtx.resume();
    }
    function warmupAudio(){
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      g.gain.value = 0.00001; // inaudible
      o.connect(g).connect(audioCtx.destination);
      o.start(now); o.stop(now + 0.01);
    }

    function woodClick(center){
      if (!audioCtx || muted) return;
      const now = audioCtx.currentTime; if (now - lastSoundTime < 0.08) return; lastSoundTime = now;
      const dur = 0.08;
      const buf = audioCtx.createBuffer(1, Math.floor(audioCtx.sampleRate*dur), audioCtx.sampleRate);
      const data = buf.getChannelData(0);
      for (let i=0;i<data.length;i++) data[i] = (Math.random()*2-1) * Math.exp(-i/(data.length*0.6));
      const src = audioCtx.createBufferSource(); src.buffer = buf;
      const bp1 = audioCtx.createBiquadFilter(); bp1.type='bandpass'; bp1.frequency.value=center; bp1.Q.value=14;
      const bp2 = audioCtx.createBiquadFilter(); bp2.type='bandpass'; bp2.frequency.value=center*0.62; bp2.Q.value=10;
      const g = audioCtx.createGain(); g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(0.08, now+0.005); g.gain.exponentialRampToValueAtTime(0.0001, now+dur);
      const o = audioCtx.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(center*1.1, now); o.frequency.exponentialRampToValueAtTime(center*0.8, now+dur);
      const og = audioCtx.createGain(); og.gain.setValueAtTime(0.0001, now); og.gain.exponentialRampToValueAtTime(0.03, now+0.004); og.gain.exponentialRampToValueAtTime(0.0001, now+dur);
      src.connect(bp1); bp1.connect(bp2); bp2.connect(g).connect(comp); o.connect(og).connect(comp);
      src.start(now); src.stop(now+dur); o.start(now); o.stop(now+dur);
    }
    function playClick(kind){ const f = kind==='inc' ? 1800 : kind==='dec' ? 1200 : 900; woodClick(f); if (!muted && navigator.vibrate) try{ navigator.vibrate(8); }catch{} }

    function step(delta, kind){ total = Math.max(0, total + delta); render(); save(); playClick(kind); }

    // Tap delay & hold acceleration (faster max speed retained)
    const TAP_GAP_MS = 300, HOLD_START_MS = 600, START_DELAY_MS = 360, MIN_DELAY_MS = 18, SPEEDUP = 0.82;

    function attachPress(btn, delta, kind){
      let holdTimer=null, repeatTimer=null, long=false, lastTap=0, activePointerId=null;
      const onDown = (e)=>{
        ensureAudio(); e.preventDefault?.(); activePointerId = e.pointerId ?? null; if (activePointerId!=null && btn.setPointerCapture) btn.setPointerCapture(activePointerId);
        btn.classList.add('is-pressing'); long=false; clearTimeout(holdTimer); clearTimeout(repeatTimer);
        holdTimer=setTimeout(()=>{ long=true; let delay=START_DELAY_MS; const tick=()=>{ step(delta, kind); delay=Math.max(MIN_DELAY_MS, delay*SPEEDUP); repeatTimer=setTimeout(tick,delay); }; tick(); }, HOLD_START_MS);
      };
      const cleanup=(e)=>{ btn.classList.remove('is-pressing'); if (activePointerId!=null && btn.hasPointerCapture?.(activePointerId)) btn.releasePointerCapture(activePointerId); activePointerId=null; clearTimeout(holdTimer); clearTimeout(repeatTimer); };
      const onUp=(e)=>{ const wasLong=long; cleanup(e); if(!wasLong){ const now=Date.now(); if (now-lastTap>=TAP_GAP_MS){ step(delta, kind); lastTap=now; } } };
      btn.addEventListener('pointerdown', onDown); btn.addEventListener('pointerup', onUp); btn.addEventListener('pointercancel', cleanup);
    }

    attachPress(incBtn, +1, 'inc');
    attachPress(decBtn, -1, 'dec');

    resetBtn.addEventListener('click', ()=>{ ensureAudio(); total=0; render(); save(); playClick('reset'); });

    // Mute UI
    function renderMute(){ muteBtn.setAttribute('aria-pressed', muted ? 'true' : 'false'); iconBell.style.display = muted ? 'none' : 'block'; iconBellOff.style.display = muted ? 'block' : 'none'; }
    renderMute();
    muteBtn.addEventListener('click', ()=>{ ensureAudio(); muted=!muted; saveMuted(); renderMute(); if (!muted) playClick('inc'); });

    render();

    // Welcome overlay handling: requires one tap to enable audio on iOS
    function dismissOverlay(){
      ensureAudio(); // resumes + warms up
      overlayEl.classList.add('hidden');
      // Optional: tiny confirmation click if not muted
      playClick('inc');
    }
    startBtn.addEventListener('click', dismissOverlay);

    const block=(e)=>e.preventDefault();
    document.addEventListener('copy', block);
    document.addEventListener('cut', block);
    document.addEventListener('contextmenu', block);
    document.addEventListener('selectstart', block);
  })();
</script>
</body>
</html>
