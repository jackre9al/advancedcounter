<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Counter</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#000000">
  <style>
    :root{ --base:150px }
    html,body{
      margin:0;height:100%;background:#000;color:#fff;
      font-family:"Segoe UI",-apple-system,BlinkMacSystemFont,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      overflow:hidden; /* no scroll */
      -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; /* disable selection */
      -webkit-touch-callout:none;
    }

    .app{
      min-height:100%;
      padding:env(safe-area-inset-top) 16px env(safe-area-inset-bottom);
      display:grid; grid-template-rows:auto 1fr auto; gap:0; box-sizing:border-box;
    }

    /* ===== Group 1: Title + mute icon ===== */
    header{ display:flex; flex-direction:column; align-items:center; justify-content:flex-end; padding:8px 2px 0 }
    header h1{ margin:0 0 8px 0; font-size:18px; font-weight:600 }
    .toolbar{ display:flex; align-items:center; justify-content:center; height:28px; }
    .mute-btn{ background:transparent; border:none; padding:0; margin:0; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; line-height:0; }
    .mute-btn .icon{ width:20px; height:20px; display:block; color:#e5e5e5 }

    /* ===== Group 2: Counter value (center) ===== */
    .count{ flex:1; display:flex; align-items:center; justify-content:center; text-align:center; }
    .value{ font-size:clamp(96px,18vw,160px); font-weight:800; line-height:1; margin:0; font-variant-numeric: tabular-nums; }

    /* ===== Group 3: Reset + controls ===== */
    section{ padding:0 0 6px; display:flex; flex-direction:column; align-items:center; }

    #reset{
      border:2px solid #333; background:#111; display:flex; cursor:pointer;
      align-items:center; justify-content:center;
      font-size:16px; letter-spacing:.22em; color:#fff; opacity:.95;
      margin:18px 0 26px; /* vertical spacing around reset */
      padding:0 34px; /* L/R spacing */
      height:56px; min-width:200px;
      border-radius:20px; transition:border-color .15s ease, background .15s ease, opacity .15s ease;
    }
    #reset:hover{ border-color:#fff; background:#141414; opacity:1 }
    #reset:active{ background:#151515 }

    .controls{ display:flex; gap:18px; align-items:center; justify-content:center; padding:0 4px 8px; }
    .btn{
      width:calc(var(--base) * 1.25); /* wider */
      height:calc(var(--base) * 1.3); /* tall */
      background:#111; border-radius:20px; color:#fff; border:2px solid #333;
      display:grid; place-items:center; user-select:none; touch-action:manipulation;
      transition:transform .08s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
      position:relative; overflow:hidden;
    }
    .btn:hover{ border-color:#fff; background:rgba(255,255,255,.06) }
    .btn.is-pressing{ transform:scale(.94); background:#141414; box-shadow: inset 0 0 0 2px rgba(255,255,255,.08), inset 0 10px 30px rgba(255,255,255,.06) }
    .glyph{ width:46%; height:46%; display:block }
    .btn-minus .glyph{ width:42%; height:42% }

    .note{ text-align:center;color:#bbb;font-size:11px;opacity:.7;margin-top:8px; }

    /* ===== Welcome overlay (tap anywhere to enable sound) ===== */
    .overlay{ position:fixed; inset:0; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:100; transition:opacity .28s ease; }
    .overlay h2{ margin:0; font-size:22px; font-weight:700; letter-spacing:.02em }
    .overlay .by{ font-size:14px; opacity:.8; margin-top:6px }
    .overlay .hint{ margin-top:18px; font-size:12px; color:#bbb; letter-spacing:.14em; text-transform:uppercase; }
    .blink{ animation:pulse 1.3s ease-in-out infinite; }
    @keyframes pulse{ 0%{opacity:.35} 50%{opacity:1} 100%{opacity:.35} }
    .overlay.hidden{ opacity:0; pointer-events:none }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>Counter</h1>
      <div class="toolbar">
        <button id="muteBtn" class="mute-btn" aria-pressed="false" aria-label="Toggle sound">
          <svg class="icon" id="iconBell" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 3a5 5 0 0 1 5 5v2.3c0 .8.3 1.6.8 2.2l1 1.2c.7.8.1 2-1 2H6.2c-1.1 0-1.7-1.2-1-2l1-1.2c.5-.6.8-1.4.8-2.2V8a5 5 0 0 1 5-5Z" fill="currentColor"/>
            <path d="M9.5 18a2.5 2.5 0 0 0 5 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" fill="none"/>
          </svg>
          <svg class="icon" id="iconBellOff" viewBox="0 0 24 24" aria-hidden="true" style="display:none">
            <path d="M4 4l16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M12 3a5 5 0 0 1 5 5v2.3c0 .8.3 1.6.8 2.2l1 1.2c.7.8.1 2-1 2H8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M6.2 15c-1.1 0-1.7-1.2-1-2l1-1.2c.5-.6.8-1.4.8-2.2V8c0-1.6.8-3 2-3.9" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M9.5 18a2.5 2.5 0 0 0 5 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" fill="none"/>
          </svg>
        </button>
      </div>
    </header>

    <main class="count">
      <div class="value" id="value">0</div>
    </main>

    <section>
      <button id="reset" aria-label="Reset">RESET</button>
      <div class="controls">
        <button class="btn btn-minus" id="dec" aria-label="Decrease">
          <svg class="glyph" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 12h14" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
          </svg>
        </button>
        <button class="btn btn-plus"  id="inc" aria-label="Increase">
          <svg class="glyph" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
          </svg>
        </button>
      </div>
      <div class="note">hold for faster value</div>
    </section>
  </div>

  <!-- Welcome overlay: tap anywhere to start -->
  <div id="overlay" class="overlay" aria-hidden="false">
    <h2>Counter</h2>
    <div class="by">by <strong>StarShots ID</strong></div>
    <div class="hint blink">Tap anywhere to start</div>
  </div>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }

  (function(){
    const valueEl = document.getElementById('value');
    const incBtn  = document.getElementById('inc');
    const decBtn  = document.getElementById('dec');
    const resetBtn= document.getElementById('reset');

    const muteBtn = document.getElementById('muteBtn');
    const iconBell = document.getElementById('iconBell');
    const iconBellOff = document.getElementById('iconBellOff');

    const overlayEl = document.getElementById('overlay');

    let total = Number(localStorage.getItem('counter:total') || 0);
    let muted = localStorage.getItem('counter:muted') === '1';

    const save = ()=>localStorage.setItem('counter:total', total);
    const saveMuted = ()=>localStorage.setItem('counter:muted', muted ? '1' : '0');
    const render=()=>{ valueEl.textContent = total; };

    // WebAudio click
    let audioCtx=null, master=null, comp=null, lastSoundTime=0;
    function warmupAudio(){
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      g.gain.value = 0.00001; // inaudible
      o.connect(g).connect(audioCtx.destination);
      o.start(now); o.stop(now + 0.01);
    }
    function ensureAudio(){
      if (!audioCtx) {
        audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        comp = audioCtx.createDynamicsCompressor();
        comp.threshold.setValueAtTime(-24, audioCtx.currentTime);
        comp.knee.setValueAtTime(30, audioCtx.currentTime);
        comp.ratio.setValueAtTime(12, audioCtx.currentTime);
        master = audioCtx.createGain(); master.gain.value = 0.6;
        comp.connect(master).connect(audioCtx.destination);
      }
      if (audioCtx.state === 'suspended') audioCtx.resume();
      warmupAudio(); // guarantee first sound
    }
    function woodClick(center){
      if (!audioCtx || muted) return;
      const now = audioCtx.currentTime; if (now - lastSoundTime < 0.08) return; lastSoundTime = now;
      const dur = 0.08;
      const buf = audioCtx.createBuffer(1, Math.floor(audioCtx.sampleRate*dur), audioCtx.sampleRate);
      const data = buf.getChannelData(0);
      for (let i=0;i<data.length;i++) data[i] = (Math.random()*2-1) * Math.exp(-i/(data.length*0.6));
      const src = audioCtx.createBufferSource(); src.buffer = buf;
      const bp1 = audioCtx.createBiquadFilter(); bp1.type='bandpass'; bp1.frequency.value=center; bp1.Q.value=14;
      const bp2 = audioCtx.createBiquadFilter(); bp2.type='bandpass'; bp2.frequency.value=center*0.62; bp2.Q.value=10;
      const g = audioCtx.createGain(); g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(0.08, now+0.005); g.gain.exponentialRampToValueAtTime(0.0001, now+dur);
      const o = audioCtx.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(center*1.1, now); o.frequency.exponentialRampToValueAtTime(center*0.8, now+dur);
      const og = audioCtx.createGain(); og.gain.setValueAtTime(0.0001, now); og.gain.exponentialRampToValueAtTime(0.03, now+0.004); og.gain.exponentialRampToValueAtTime(0.0001, now+dur);
      src.connect(bp1); bp1.connect(bp2); bp2.connect(g).connect(comp); o.connect(og).connect(comp);
      src.start(now); src.stop(now+dur); o.start(now); o.stop(now+dur);
    }
    function playClick(kind){ const f = kind==='inc' ? 1800 : kind==='dec' ? 1200 : 900; woodClick(f); if (!muted && navigator.vibrate) try{ navigator.vibrate(8); }catch{} }

    function step(delta, kind){ total = Math.max(0, total + delta); render(); save(); playClick(kind); }

    const TAP_GAP_MS = 300, HOLD_START_MS = 600, START_DELAY_MS = 360, MIN_DELAY_MS = 18, SPEEDUP = 0.82;

    function attachPress(btn, delta, kind){
      let holdTimer=null, repeatTimer=null, long=false, lastTap=0, activePointerId=null;
      const onDown = (e)=>{
        ensureAudio(); e.preventDefault?.(); activePointerId = e.pointerId ?? null; if (activePointerId!=null && btn.setPointerCapture) btn.setPointerCapture(activePointerId);
        btn.classList.add('is-pressing'); long=false; clearTimeout(holdTimer); clearTimeout(repeatTimer);
        holdTimer=setTimeout(()=>{ long=true; let delay=START_DELAY_MS; const tick=()=>{ step(delta, kind); delay=Math.max(MIN_DELAY_MS, delay*SPEEDUP); repeatTimer=setTimeout(tick,delay); }; tick(); }, HOLD_START_MS);
      };
      const cleanup=(e)=>{ btn.classList.remove('is-pressing'); if (activePointerId!=null && btn.hasPointerCapture?.(activePointerId)) btn.releasePointerCapture(activePointerId); activePointerId=null; clearTimeout(holdTimer); clearTimeout(repeatTimer); };
      const onUp=(e)=>{ const wasLong=long; cleanup(e); if(!wasLong){ const now=Date.now(); if (now-lastTap>=TAP_GAP_MS){ step(delta, kind); lastTap=now; } } };
      btn.addEventListener('pointerdown', onDown); btn.addEventListener('pointerup', onUp); btn.addEventListener('pointercancel', cleanup);
    }

    attachPress(incBtn, +1, 'inc');
    attachPress(decBtn, -1, 'dec');

    resetBtn.addEventListener('click', ()=>{ ensureAudio(); total=0; render(); save(); playClick('reset'); });

    function renderMute(){ muteBtn.setAttribute('aria-pressed', muted ? 'true' : 'false'); iconBell.style.display = muted ? 'none' : 'block'; iconBellOff.style.display = muted ? 'block' : 'none'; }
    renderMute();
    muteBtn.addEventListener('click', ()=>{ ensureAudio(); muted=!muted; saveMuted(); renderMute(); if (!muted) playClick('inc'); });

    render();

    // Tap-anywhere overlay: first pointerdown anywhere dismisses and warms audio
    const firstTap = (e)=>{
      if (overlayEl.classList.contains('hidden')) return;
      ensureAudio();
      overlayEl.classList.add('hidden');
      document.removeEventListener('pointerdown', firstTap, {capture:true});
    };
    document.addEventListener('pointerdown', firstTap, {capture:true, passive:true});

    const block=(e)=>e.preventDefault();
    document.addEventListener('copy', block);
    document.addEventListener('cut', block);
    document.addEventListener('contextmenu', block);
    document.addEventListener('selectstart', block);
  })();
</script>
</body>
</html>
