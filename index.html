<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Dual Counter</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#000000">
  <style>
    :root{ --base:150px }
    html,body{
      margin:0;height:100%;background:#000;color:#fff;
      font-family:"Segoe UI",-apple-system,BlinkMacSystemFont,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased
    }

    .app{
      min-height:100%;
      padding:env(safe-area-inset-top) 16px env(safe-area-inset-bottom);
      display:grid; grid-template-rows:auto 1fr auto; gap:16px; box-sizing:border-box;
    }

    header{ display:flex;justify-content:space-between;align-items:center;padding:4px 2px }
    header h1{ margin:0;font-size:18px;font-weight:600 }

    .count{
      height:100%;
      display:flex; align-items:center; justify-content:center;
      text-align:center;
    }
    .wrap{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; }

    .big-row{ display:flex; align-items:baseline; gap:10px; font-weight:600; opacity:.95; font-size:clamp(18px,3.8vw,30px); }
    .big-num{ font-variant-numeric: tabular-nums; }
    .big-total{ font-weight:700; opacity:1; } /* bold (total) */

    .value{
      font-size:clamp(96px,18vw,160px);
      font-weight:800; line-height:1; margin:0;
      font-variant-numeric: tabular-nums;
    }

    .controls{
      display:grid;grid-template-columns:1fr 1fr;gap:18px;align-items:center;
      padding:0 4px 8px;justify-items:center
    }
    .btn{
      width:var(--base);height:var(--base);
      background:#111;border-radius:20px;
      color:#fff;border:2px solid #333;
      display:grid;place-items:center;
      font-weight:900;user-select:none;touch-action:manipulation;
      transition:transform .06s ease,opacity .2s ease, border-color .2s ease, background .2s ease;
    }
    .btn:hover{ border-color:#fff; background:rgba(255,255,255,.06) }
    .btn:active{ transform:scale(.96) }
    .btn span{ line-height:1 }
    .btn-minus span{ font-size:calc(var(--base)*.42) }
    .btn-plus  span{ font-size:calc(var(--base)*.50) }

    #reset{
      border:none;background:transparent;display:block;cursor:pointer;
      font-size:17px;letter-spacing:.22em;color:#fff;opacity:.9;
      margin:12px auto 6px;
    }
    #reset:active{ opacity:1 }

    .note{ text-align:center;color:#bbb;font-size:11px;opacity:.7;margin-top:6px; }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header><h1>Counter by StarShots ID</h1></header>

    <main class="count">
      <div class="wrap">
        <div class="big-row">
          <span class="big-num" id="big">0</span>
          <span class="big-total" id="total">(0)</span>
        </div>
        <div class="value" id="value">0</div>
      </div>
    </main>

    <section>
      <button id="reset" aria-label="Reset">RESET</button>
      <div class="controls">
        <button class="btn btn-minus" id="dec" aria-label="Decrease"><span>âˆ’</span></button>
        <button class="btn btn-plus"  id="inc" aria-label="Increase"><span>+</span></button>
      </div>
      <div class="note">hold for faster value</div>
    </section>
  </div>

<script>
  // Service worker registration (works with sw.js in same folder)
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').then(reg => {
      let refreshing=false;
      navigator.serviceWorker.addEventListener('controllerchange',()=>{
        if(refreshing) return; refreshing=true; location.reload();
      });
    }).catch(()=>{});
  }

  (function(){
    // ----- CONFIG -----
    const LIMIT = 7;
    const TAP_GAP_MS = 300;
    const HOLD_START_MS = 600;
    const START_DELAY_MS = 400;
    const MIN_DELAY_MS = 50;
    const SPEEDUP = 0.85;

    // ----- ELEMENTS -----
    const bigEl   = document.getElementById('big');
    const smallEl = document.getElementById('value');
    const totalEl = document.getElementById('total');
    const incBtn  = document.getElementById('inc');
    const decBtn  = document.getElementById('dec');
    const resetBtn= document.getElementById('reset');

    // ----- STATE: single total -----
    let total = Number(localStorage.getItem('counter:total') || 0);

    function save(){ localStorage.setItem('counter:total', total); }

    // NEW: big = floor(total/7); small = (total%7) except 0 -> 7 (unless total==0)
    function mapTotalToDisplay(t){
      if (t === 0) return { big:0, small:0 };
      const q = Math.floor(t / LIMIT);  // groups completed
      const r = t % LIMIT;
      return { big: q, small: r === 0 ? 7 : r };
    }

    function render(){
      const { big, small } = mapTotalToDisplay(total);
      bigEl.textContent = big;
      smallEl.textContent = small;
      totalEl.textContent = '(' + total + ')'; // bold via CSS
    }

    function step(delta){
      total = Math.max(0, total + delta);
      render(); save();
    }

    // Accelerating long-press with 300ms tap gap
    function attachPress(btn, delta){
      let holdTimer=null, repeatTimer=null, long=false, lastTap=0;

      const onDown = (e)=>{
        e.preventDefault?.();
        long=false;
        clearTimeout(holdTimer); clearTimeout(repeatTimer);
        holdTimer=setTimeout(()=>{
          long=true;
          let delay=START_DELAY_MS;
          const tick=()=>{
            step(delta);
            delay=Math.max(MIN_DELAY_MS, delay*SPEEDUP);
            repeatTimer=setTimeout(tick, delay);
          };
          tick();
        }, HOLD_START_MS);
      };

      const onUp = ()=>{
        clearTimeout(holdTimer); clearTimeout(repeatTimer);
        if(!long){
          const now=Date.now();
          if(now-lastTap>=TAP_GAP_MS){
            step(delta);
            lastTap=now;
          }
        }
      };

      btn.addEventListener('pointerdown', onDown);
      btn.addEventListener('pointerup', onUp);
      btn.addEventListener('pointercancel', onUp);
      btn.addEventListener('pointerleave', onUp);
      btn.addEventListener('blur', onUp);
    }

    attachPress(incBtn, +1);
    attachPress(decBtn, -1);
    resetBtn.addEventListener('click', ()=>{ total=0; render(); save(); });

    render();
  })();
</script>
</body>
</html>
