<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Counter</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#000000">
  <style>
    :root{ --base:150px }
    html,body{
      margin:0;height:100%;background:#000;color:#fff;
      font-family:"Segoe UI",-apple-system,BlinkMacSystemFont,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      overflow:hidden; /* no scroll */
      -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; /* disable selection */
      -webkit-touch-callout:none;
    }

    .app{
      min-height:100%;
      padding:env(safe-area-inset-top) 16px env(safe-area-inset-bottom);
      display:grid; grid-template-rows:auto 1fr auto; gap:16px; box-sizing:border-box;
    }

    header{ display:flex;justify-content:center;align-items:center;padding:4px 2px }
    header h1{ margin:0;font-size:18px;font-weight:600 }

    .count{
      height:100%;
      display:flex; align-items:center; justify-content:center;
      text-align:center;
    }

    .value{
      font-size:clamp(96px,18vw,160px);
      font-weight:800; line-height:1; margin:0;
      font-variant-numeric: tabular-nums;
    }

    section{ padding-bottom:6px; display:flex; flex-direction:column; align-items:center; }

    .controls{
      display:flex;gap:18px;align-items:center;justify-content:center;
      padding:0 4px 8px;
    }
    .btn{
      width:var(--base);height:calc(var(--base) * 1.3); /* taller buttons only */
      background:#111;border-radius:20px;
      color:#fff;border:2px solid #333;
      display:grid;place-items:center;
      user-select:none;touch-action:manipulation;
      transition:transform .08s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
      position:relative; overflow:hidden;
    }
    .btn:hover{ border-color:#fff; background:rgba(255,255,255,.06) }
    .btn.is-pressing{ transform:scale(.94); background:#141414; box-shadow: inset 0 0 0 2px rgba(255,255,255,.08), inset 0 10px 30px rgba(255,255,255,.06) }
    .glyph{ width:46%; height:46%; display:block }
    .btn-minus .glyph{ width:42%; height:42% }

    /* Reset button aligned in center with spacing */
    #reset{
      border:2px solid #333; background:#111; display:flex; cursor:pointer;
      align-items:center; justify-content:center;
      font-size:16px; letter-spacing:.22em; color:#fff; opacity:.95;
      margin:16px 0 24px; /* vertical spacing above and below */
      padding:0 32px; /* balanced left/right spacing */
      height:56px; min-width:200px;
      border-radius:20px; transition:border-color .15s ease, background .15s ease, opacity .15s ease;
    }
    #reset:hover{ border-color:#fff; background:#141414; opacity:1 }
    #reset:active{ background:#151515 }

    .note{ text-align:center;color:#bbb;font-size:11px;opacity:.7;margin-top:8px; }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header><h1>Counter</h1></header>

    <main class="count">
      <div class="value" id="value">0</div>
    </main>

    <section>
      <button id="reset" aria-label="Reset">RESET</button>
      <div class="controls">
        <button class="btn btn-minus" id="dec" aria-label="Decrease">
          <svg class="glyph" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 12h14" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
          </svg>
        </button>
        <button class="btn btn-plus"  id="inc" aria-label="Increase">
          <svg class="glyph" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
          </svg>
        </button>
      </div>
      <div class="note">hold for faster value</div>
    </section>
  </div>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }

  (function(){
    const valueEl = document.getElementById('value');
    const incBtn  = document.getElementById('inc');
    const decBtn  = document.getElementById('dec');
    const resetBtn= document.getElementById('reset');

    let total = Number(localStorage.getItem('counter:total') || 0);
    const save = ()=>localStorage.setItem('counter:total', total);
    const render=()=>{ valueEl.textContent = total; };

    // ---- WebAudio soft 'tut' ----
    let audioCtx=null;
    function ensureAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
    }
    function playClick(kind){
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'sine';
      const f = kind==='inc' ? 1800 : kind==='dec' ? 1400 : 600;
      o.frequency.setValueAtTime(f, now);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.03, now+0.005);
      g.gain.exponentialRampToValueAtTime(0.0001, now+0.07);
      o.connect(g).connect(audioCtx.destination);
      o.start(now); o.stop(now+0.08);
    }

    function step(delta, kind){ total = Math.max(0, total + delta); render(); save(); playClick(kind); }

    const TAP_GAP_MS = 300; // delay between single taps

    function attachPress(btn, delta, kind){
      let holdTimer=null, repeatTimer=null, long=false, lastTap=0;
      let activePointerId=null;

      const onDown = (e)=>{
        ensureAudio();
        e.preventDefault?.();
        activePointerId = e.pointerId ?? null;
        if (activePointerId!=null && btn.setPointerCapture) btn.setPointerCapture(activePointerId);
        btn.classList.add('is-pressing');
        long=false;
        clearTimeout(holdTimer); clearTimeout(repeatTimer);
        holdTimer=setTimeout(()=>{
          long=true;
          let delay=400;               // initial repeat delay
          const tick=()=>{ step(delta, kind); delay=Math.max(50, delay*0.85); repeatTimer=setTimeout(tick,delay); };
          tick();
        }, 600); // long-press start
      };

      const cleanup=(e)=>{
        btn.classList.remove('is-pressing');
        if (activePointerId!=null && btn.hasPointerCapture?.(activePointerId)) btn.releasePointerCapture(activePointerId);
        activePointerId=null;
        clearTimeout(holdTimer); clearTimeout(repeatTimer);
      };

      const onUp=(e)=>{
        const wasLong=long; cleanup(e);
        if(!wasLong){
          const now = Date.now();
          if (now - lastTap >= TAP_GAP_MS){ step(delta, kind); lastTap = now; }
        }
      };

      btn.addEventListener('pointerdown', onDown);
      btn.addEventListener('pointerup', onUp);
      btn.addEventListener('pointercancel', cleanup);
    }

    attachPress(incBtn, +1, 'inc');
    attachPress(decBtn, -1, 'dec');

    resetBtn.addEventListener('click', ()=>{ ensureAudio(); total=0; render(); save(); playClick('reset'); });

    render();

    const block=(e)=>e.preventDefault();
    document.addEventListener('copy', block);
    document.addEventListener('cut', block);
    document.addEventListener('contextmenu', block);
    document.addEventListener('selectstart', block);
  })();
</script>
</body>
</html>
