<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Counter</title>
  <!--
    This page implements a simple counter app designed for use on phones and tablets.
    It keeps the UI on a single screen (no scrolling), disables text selection and
    copy/paste, supports press‑and‑hold auto repeat on the +/− buttons, and
    includes optional sound feedback with a toggle. The first press after
    launching on iOS requires a user gesture to unlock the AudioContext, so a
    full‑screen overlay invites the user to tap anywhere to start. Once
    dismissed, audio will work immediately on the very first button press.
  -->
  <style>
    :root {
      /* Base size for control buttons. Adjust to make buttons taller or shorter. */
      --base: 150px;
      /* Increase width relative to height for the increment/decrement buttons. */
      --btn-width: calc(var(--base) * 1.2);
    }

    /* Reset margins and prevent scrolling */
    html, body {
      margin: 0;
      height: 100%;
      background: #000;
      color: #fff;
      font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, Inter, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      overflow: hidden; /* lock layout to one screen */
      /* Disable selection and long‑press callouts */
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
    }

    /* Container for the entire app. Uses flex to divide into top, middle and bottom groups. */
    .app {
      min-height: 100%;
      padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      box-sizing: border-box;
      text-align: center;
    }

    /* ===== Top group (title and sound toggle) ===== */
    .top {
      padding-top: 4px;
    }
    .top h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }
    /* Sound toggle button */
    .sound-toggle {
      margin-top: 8px;
      border: none;
      background: transparent;
      color: #fff;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .sound-toggle svg {
      width: 24px;
      height: 24px;
      display: none;
    }
    .sound-toggle svg.active {
      display: block;
    }

    /* ===== Middle group (counter value) ===== */
    .value {
      font-size: clamp(96px, 18vw, 160px);
      font-weight: 800;
      line-height: 1;
      margin: 0;
      font-variant-numeric: tabular-nums;
    }

    /* ===== Bottom group (reset, controls and hint) ===== */
    .bottom {
      width: 100%;
    }
    #reset {
      width: 180px;
      margin: 0 auto 16px;
      padding: 12px 24px;
      border-radius: 20px;
      border: 2px solid #333;
      background: #111;
      color: #fff;
      font-size: 18px;
      letter-spacing: 0.2em;
      cursor: pointer;
      transition: background 0.12s ease, border-color 0.12s ease;
    }
    #reset:hover {
      border-color: #fff;
      background: rgba(255, 255, 255, 0.06);
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      justify-items: center;
      margin-bottom: 8px;
    }
    .btn {
      width: var(--btn-width);
      height: var(--base);
      background: #111;
      border-radius: 20px;
      color: #fff;
      border: 2px solid #333;
      display: grid;
      place-items: center;
      user-select: none;
      touch-action: manipulation;
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease, border-color 0.12s ease;
      position: relative;
      overflow: hidden;
    }
    .btn:hover {
      border-color: #fff;
      background: rgba(255, 255, 255, 0.06);
    }
    .btn.is-pressing {
      transform: scale(0.94);
      background: #141414;
      box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.08), inset 0 10px 30px rgba(255, 255, 255, 0.06);
    }
    .glyph {
      width: 46%;
      height: 46%;
      display: block;
    }
    .btn-minus .glyph {
      width: 42%;
      height: 42%;
    }
    .note {
      text-align: center;
      color: #bbb;
      font-size: 11px;
      opacity: 0.7;
    }

    /* ===== Overlay shown on first load to unlock audio ===== */
    .overlay {
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.25s ease;
    }
    .overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .overlay h2 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
    }
    .overlay h2 small {
      display: block;
      font-size: 14px;
      font-weight: 400;
      opacity: 0.8;
      margin-top: 4px;
    }
    .overlay .hint {
      margin-top: 12px;
      font-size: 14px;
      opacity: 0.7;
      animation: pulse 1.5s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <!-- Top group: title and sound toggle -->
    <div class="top">
      <h1>Counter</h1>
      <button id="sound-toggle" class="sound-toggle" aria-label="Toggle sound">
        <!-- Bell icon (sound on) -->
        <svg class="icon-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9" />
          <path d="M13.73 21a2 2 0 0 1-3.46 0" />
        </svg>
        <!-- Bell with slash (sound off) -->
        <svg class="icon-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9" />
          <path d="M13.73 21a2 2 0 0 1-3.46 0" />
          <path d="M1 1l22 22" />
        </svg>
      </button>
    </div>

    <!-- Middle group: counter value -->
    <div class="middle">
      <div class="value" id="value">0</div>
    </div>

    <!-- Bottom group: reset button, controls and note -->
    <div class="bottom">
      <button id="reset" aria-label="Reset">RESET</button>
      <div class="controls">
        <button class="btn btn-minus" id="dec" aria-label="Decrease">
          <svg class="glyph" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 12h14" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none" />
          </svg>
        </button>
        <button class="btn btn-plus" id="inc" aria-label="Increase">
          <svg class="glyph" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none" />
          </svg>
        </button>
      </div>
      <div class="note">hold for faster value</div>
    </div>
  </div>

  <!-- Full‑screen welcome overlay for unlocking audio on first use -->
  <div class="overlay" id="overlay">
    <h2>Counter<small>by&nbsp;StarShots&nbsp;ID</small></h2>
    <div class="hint">Tap anywhere to start</div>
  </div>

  <script>
    // Register the service worker if present.
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(function () {});
    }

    (function () {
      // ----- Configuration -----
      const TAP_GAP_MS = 300;
      const HOLD_START_MS = 600;
      const START_DELAY_MS = 350;
      const MIN_DELAY_MS = 18; // final hold speed floor
      const SPEEDUP = 0.85;

      // ----- DOM references -----
      const valueEl = document.getElementById('value');
      const incBtn = document.getElementById('inc');
      const decBtn = document.getElementById('dec');
      const resetBtn = document.getElementById('reset');
      const soundToggle = document.getElementById('sound-toggle');
      const iconOn = soundToggle.querySelector('.icon-on');
      const iconOff = soundToggle.querySelector('.icon-off');
      const overlayEl = document.getElementById('overlay');

      // ----- Counter state -----
      let total = parseInt(localStorage.getItem('counter:total') || '0', 10);
      function render() {
        valueEl.textContent = total;
      }
      function save() {
        localStorage.setItem('counter:total', String(total));
      }
      function step(delta) {
        total = Math.max(0, total + delta);
        render();
        save();
      }

      // ----- Audio handling -----
      let audioCtx;
      let audioReadyAt = 0;
      let soundOn = localStorage.getItem('soundOn') !== 'false'; // default true
      function ensureAudio() {
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        return audioCtx.state === 'suspended' ? audioCtx.resume() : Promise.resolve();
      }
      function warmAudio() {
        return ensureAudio().then(function () {
          const ctx = audioCtx;
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          gain.gain.value = 0.0001; // inaudible
          osc.connect(gain).connect(ctx.destination);
          osc.start();
          osc.stop(ctx.currentTime + 0.02);
          // After warming, allow first audible click after 80 ms
          audioReadyAt = performance.now() + 80;
        });
      }
      function playClick(freq) {
        if (!soundOn) {
          // Provide a short haptic feedback if available when sound is off
          if (navigator.vibrate) navigator.vibrate(8);
          return;
        }
        const ctx = audioCtx;
        const now = ctx.currentTime;
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(freq, now);
        // envelope
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(0.05, now + 0.005);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.08);
        gain.gain.linearRampToValueAtTime(0, now + 0.12);
        osc.connect(gain).connect(ctx.destination);
        osc.start(now);
        osc.stop(now + 0.12);
      }
      function clickSound(freq) {
        const now = performance.now();
        if (now < audioReadyAt) {
          const delay = audioReadyAt - now;
          setTimeout(function () {
            playClick(freq);
          }, delay);
        } else {
          playClick(freq);
        }
      }

      // Update the sound toggle icons based on current state
      function updateSoundIcon() {
        if (soundOn) {
          iconOn.classList.add('active');
          iconOff.classList.remove('active');
        } else {
          iconOn.classList.remove('active');
          iconOff.classList.add('active');
        }
      }
      updateSoundIcon();
      // Toggle sound state on click
      soundToggle.addEventListener('click', function (e) {
        e.stopPropagation();
        soundOn = !soundOn;
        localStorage.setItem('soundOn', soundOn ? 'true' : 'false');
        updateSoundIcon();
      });

      // ----- Welcome overlay logic -----
      if (overlayEl) {
        function dismissOverlay() {
          if (!overlayEl.classList.contains('hidden')) {
            overlayEl.classList.add('hidden');
            warmAudio();
          }
        }
        // If audio has been enabled before, hide overlay immediately and warm audio
        if (localStorage.getItem('audioEnabled')) {
          overlayEl.classList.add('hidden');
          warmAudio();
        } else {
          // On first interaction, hide overlay and mark audio enabled
          overlayEl.addEventListener('click', function () {
            localStorage.setItem('audioEnabled', '1');
            dismissOverlay();
          }, { once: true });
        }
      } else {
        // No overlay present (shouldn’t happen), warm audio immediately
        warmAudio();
      }

      // ----- Press handling with auto‑repeat and acceleration -----
      function attachPress(btn, delta, freq) {
        let holdTimer = null;
        let repeatTimer = null;
        let long = false;
        let lastTap = 0;
        let activeId = null;
        function onDown(e) {
          e.preventDefault();
          activeId = e.pointerId ?? null;
          if (activeId != null && btn.setPointerCapture) btn.setPointerCapture(activeId);
          btn.classList.add('is-pressing');
          long = false;
          clearTimeout(holdTimer);
          clearTimeout(repeatTimer);
          holdTimer = setTimeout(function () {
            long = true;
            let delay = START_DELAY_MS;
            function tick() {
              step(delta);
              clickSound(freq);
              delay = Math.max(MIN_DELAY_MS, delay * SPEEDUP);
              repeatTimer = setTimeout(tick, delay);
            }
            tick();
          }, HOLD_START_MS);
        }
        function cleanup() {
          btn.classList.remove('is-pressing');
          if (activeId != null && btn.hasPointerCapture?.(activeId)) {
            btn.releasePointerCapture(activeId);
          }
          activeId = null;
          clearTimeout(holdTimer);
          clearTimeout(repeatTimer);
        }
        function onUp() {
          const wasLong = long;
          cleanup();
          if (!wasLong) {
            const now = Date.now();
            if (now - lastTap >= TAP_GAP_MS) {
              step(delta);
              clickSound(freq);
              lastTap = now;
            }
          }
        }
        btn.addEventListener('pointerdown', onDown);
        btn.addEventListener('pointerup', onUp);
        btn.addEventListener('pointercancel', cleanup);
      }
      // Attach handlers for increment and decrement with different click tones
      attachPress(incBtn, +1, 660); // high tone
      attachPress(decBtn, -1, 440); // low tone
      // Reset button clears count and plays a tone
      resetBtn.addEventListener('click', function () {
        total = 0;
        render();
        save();
        clickSound(330);
      });
      // Render initial value
      render();
      // Prevent context menu everywhere
      document.addEventListener('contextmenu', function (e) {
        e.preventDefault();
      });
    })();
  </script>
</body>
</html>